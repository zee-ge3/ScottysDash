<!DOCTYPE html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=no"><title>Infinite Ski</title><style>*{margin:0;padding:0}body{background:#000;overflow:hidden;touch-action:none}canvas{display:block}</style></head><body><canvas id=c></canvas><script>
// ZzFX Micro - Sound Generator
zzfxG=(p=1,k=.05,b=.22,e=0,r=0,t=.1,u=0,f=1,v=0,z=0,w=0,A=0,l=0,B=0,C=0,F=0,d=0,q=1,h=0,I=0)=>{let a=2*Math.PI,R=44100,m=Math.max,s=v*=500*a/R/R,O=b*R|0,n=t*R|0,J=e*R|0,E=r*R|0,X=d*R|0,Y=h*R|0,Z=I*R|0,T=O+J+n+E+X,i=T,o=[],y=0,j=0,K=0;for(;K<i;K++){let L=K/R,M=K<O?K/O:K<O+J?1:K<T-E?m(0,1-(K-O-J)/n):K<T?m(0,1-((K-T+E)/E)):0;M=M<=0?0:M;y+=1+u*2*a/R;let N=Math.sin(y)*M*p*(1+B*Math.sin(2*a*L*l));j+=N;if(z||w||A){s+=w*500*a/R/R;v=z*500*a/R+s;j+=Math.sin(v)*A*M}o.push(F?K<Y?0:K>T-Z?0:N*(1+C*Math.sin(2*a*L*f)):N*(1+C*Math.sin(2*a*L*f)))}return o};

let c=document.getElementById('c'),g=c.getContext('2d');
let W,H;
function resize(){W=c.width=innerWidth;H=c.height=innerHeight}
resize();onresize=resize;

const DRAW=80,PI=Math.PI;
let state=0,speed=0,turnRate=0;
let score=0,combo=1,maxCombo=1,hiScore=+localStorage.getItem('hs')||0;
let inputX=0,inputTuck=0,crashed=0,crashTimer=0;
let particles=[],shakeX=0,shakeY=0;
let lastTime=0,audioCtx,sndCarve;
// Player world position
let pX=0,pY=0,pZ=0;
// Camera world position (smoothed, decoupled from player)
let camX=0,camY=3,camZ=-5;
// Player screen position (updated by render, used by particles)
let pScrX=0,pScrY=0,slopeVal=0;

function lerp(a,b,t){return a+(b-a)*t}

function initAudio(){
if(audioCtx)return;
try{
audioCtx=new(window.AudioContext||webkitAudioContext);
audioCtx.resume();
sndCarve=zzfxG(.3,.02,.08,0,.04,.04,2,1.5);
}catch(e){}
}
function playBuf(buf){
if(!audioCtx||!buf)return;
try{
let b=audioCtx.createBuffer(1,buf.length,44100),d=b.getChannelData(0);
for(let i=0;i<buf.length;i++)d[i]=buf[i];
let s=audioCtx.createBufferSource();
s.buffer=b;s.connect(audioCtx.destination);s.start();
}catch(e){}
}

// === 1. SOURCE OF TRUTH: Height function ===
function getHeight(x,z){
return (Math.sin(z*0.009)*40+Math.sin(z*0.023)*20+Math.sin(z*0.051)*10
+Math.sin(z*0.1)*8+Math.sin(x*0.04+z*0.012)*5)*0.25;
}

// Visual curvature (lateral path bending for aesthetics)
function curvature(z){return Math.sin(z*0.013)*5+Math.sin(z*0.029)*3+Math.sin(z*0.067)*1.5}
function terrainType(i){let v=Math.sin(i*0.037)*0.5+0.5;if(i>500)v+=0.15;if(i>1500)v+=0.15;return v<0.25?0:v<0.6?1:v<0.8?2:3}

// Draw trapezoid
function D(x1,y1,w1,x2,y2,w2,col){
g.fillStyle=col;
g.beginPath();
g.moveTo(x1-w1,y1);g.lineTo(x1+w1,y1);
g.lineTo(x2+w2,y2);g.lineTo(x2-w2,y2);
g.fill();
}

// Mountain range with optional snow caps
function drawMtn(by,h,s,c,ox,sc){
g.fillStyle=c;g.beginPath();g.moveTo(-20,H);
for(let i=-20;i<=W+20;i+=6){
let w=i+ox,m=Math.sin(w*.005+s)*h*.4+Math.sin(w*.013+s*2.3)*h*.35+Math.sin(w*.027+s*4.7)*h*.25;
g.lineTo(i,by-m);
}
g.lineTo(W+20,H);g.closePath();g.fill();
if(sc){
g.fillStyle=sc;g.beginPath();
let sl=h*.45;
g.moveTo(-20,by-sl);
for(let i=-20;i<=W+20;i+=6){
let w=i+ox,m=Math.sin(w*.005+s)*h*.4+Math.sin(w*.013+s*2.3)*h*.35+Math.sin(w*.027+s*4.7)*h*.25;
g.lineTo(i,m>sl?by-m:by-sl);
}
g.lineTo(W+20,by-sl);g.closePath();g.fill();
}
}

// === 4. RENDERING: Project world from camera perspective ===
function render(){
let horizon=H*0.38;
let focal=H*0.5;

// Full-screen sky gradient
let skyG=g.createLinearGradient(0,0,0,H);
skyG.addColorStop(0,'#3a7fb7');
skyG.addColorStop(0.3,'#7ab8e0');
skyG.addColorStop(0.55,'#c0ddf0');
skyG.addColorStop(1,'#e0e8f0');
g.fillStyle=skyG;
g.fillRect(0,0,W,H);

// Mountain ranges with parallax (far to near, each fills to screen bottom)
let px=-camX,fz=camZ*0.05,tr=turnRate*W*0.012;
drawMtn(H*0.22,100,0.5,'#b0c0d4',px*0.15+fz*0.1+tr*0.15);
drawMtn(H*0.30,85,1.7,'#9aabbd',px*0.35+fz*0.2+tr*0.3,'#d0dce8');
drawMtn(H*0.38,65,3.1,'#8494a8',px*0.7+fz*0.5+tr*0.6);
drawMtn(H*0.45,50,5.3,'#7080a0',px*1.2+fz*0.8+tr);

let baseI=Math.floor(camZ);

// Build terrain segments: project each strip from camera perspective
let segs=[];
let accCurve=0;
let playerN=Math.round(pZ-camZ);
let playerAccCurve=0;

for(let n=0;n<=DRAW;n++){
let si=baseI+n;
let dz=si-camZ;
if(dz<0.2)dz=0.2;

// Accumulate visual curvature
accCurve+=curvature(si)*0.008;
if(n==playerN)playerAccCurve=accCurve;

// Sample ground height at this strip's world Z
let groundH=getHeight(camX,si);
// Height relative to camera (negative = camera above ground)
let relY=groundH-camY;

// Perspective projection from camera viewpoint
let sy=horizon-relY*focal/dz+shakeY;
let sx=W/2+accCurve*W*0.15/dz+shakeX;
let tw=Math.max(W,W*2.5/dz);

segs.push({si:si,sx:sx,sy:sy,tw:tw,dz:dz});
}

// Render strips far to near (painter's algorithm)
for(let k=segs.length-1;k>0;k--){
let f=segs[k],nr=segs[k-1];
if(f.sy<-50&&nr.sy<-50)continue;

let tt=terrainType(f.si);
let ch=f.si%2==0;
let col;
if(tt==0)col=ch?'#e8eef4':'#d8e0e8';
else if(tt==1)col=ch?'#f0f5fa':'#e2eaf2';
else if(tt==2)col=ch?'#c0d4e8':'#aec4d8';
else col=ch?'#d0d8e0':'#c0c8d0';

D(f.sx,f.sy,f.tw,nr.sx,nr.sy+1,nr.tw,col);
}

// Speed streaks (radial from vanishing point)
if(speed>5&&state==1){
let n=((speed-5)*1.5+Math.max(0,-slopeVal)*3)|0;
let cx=W/2,cy=horizon;
for(let i=0;i<n;i++){
let a=Math.random()*PI*2;
let r1=(0.15+Math.random()*0.35)*H;
let r2=r1+10+speed*3;
let x1=cx+Math.cos(a)*r1;
let y1=cy+Math.sin(a)*r1*0.6;
let x2=cx+Math.cos(a)*r2;
let y2=cy+Math.sin(a)*r2*0.6;
if(y1>horizon*0.7){
g.strokeStyle=`rgba(255,255,255,${Math.min(0.4,(speed-5)*0.03)})`;
g.lineWidth=1+speed*0.05;
g.beginPath();g.moveTo(x1,y1);g.lineTo(x2,y2);g.stroke();
}}
}

// === 5. RENDER PLAYER: Project player model within the world ===
let playerDZ=pZ-camZ;
if(playerDZ>0.3){
let relX=pX-camX;
let relY=pY-camY;
pScrX=W/2+(playerAccCurve+relX*2)*W*0.15/playerDZ+shakeX;
pScrY=horizon-relY*focal/playerDZ+shakeY;
let pSc=9/playerDZ;
drawSkier(pScrX,pScrY,pSc);
}

// Particles
for(let i=particles.length-1;i>=0;i--){
let p=particles[i];
p.x+=p.vx;p.y+=p.vy;p.vy+=0.1;p.life--;
g.fillStyle=`rgba(255,255,255,${p.life/p.ml})`;
g.fillRect(p.x,p.y,p.sz,p.sz);
if(p.life<=0)particles.splice(i,1);
}
}

// Draw skier at projected screen position with perspective scale
function drawSkier(sx,sy,sc){
let lean=turnRate*0.3;
g.save();
g.translate(sx,sy);
g.scale(sc,sc);
g.rotate(lean*0.15);

// Shadow
g.fillStyle='rgba(0,0,0,0.15)';
g.beginPath();g.ellipse(0,14,12,4,0,0,PI*2);g.fill();

// Skis
g.fillStyle='#225';
g.save();g.rotate(lean*0.2);
g.fillRect(-10,8,3,22);
g.fillRect(7,8,3,22);
g.restore();

// Legs
g.fillStyle='#222';
let legH=inputTuck?8:12;
g.fillRect(-6,0,4,legH);
g.fillRect(2,0,4,legH);

// Body
g.fillStyle='#d22';
if(inputTuck){g.fillRect(-8,-6,16,8)}
else{g.fillRect(-7,-14,14,16)}

// Arms + poles
g.strokeStyle='#222';g.lineWidth=2;
let armY=inputTuck?-4:-8;
g.beginPath();g.moveTo(-7,armY);g.lineTo(-14+lean*3,armY+8);g.stroke();
g.beginPath();g.moveTo(7,armY);g.lineTo(14+lean*3,armY+8);g.stroke();
g.strokeStyle='#999';g.lineWidth=1;
g.beginPath();g.moveTo(-14+lean*3,armY+8);g.lineTo(-16+lean*4,armY+25);g.stroke();
g.beginPath();g.moveTo(14+lean*3,armY+8);g.lineTo(16+lean*4,armY+25);g.stroke();

// Head
g.fillStyle='#fdb';
let headY=inputTuck?-10:-18;
g.beginPath();g.arc(0,headY,5,0,PI*2);g.fill();
g.fillStyle='#d22';
g.beginPath();g.arc(0,headY-1,5,PI,0);g.fill();
g.fillStyle='#333';
g.fillRect(-4,headY-2,8,3);

g.restore();
}

function spraySnow(){
for(let i=0;i<3;i++){
particles.push({
x:pScrX+(turnRate>0?-15:15),y:pScrY+10,
vx:-turnRate*2+Math.random()*2-1,
vy:-Math.random()*3-1,
life:15+Math.random()*10|0,ml:25,
sz:2+Math.random()*3
});
}
}

function ambientSnow(){
if(Math.random()<0.3+speed*0.05){
particles.push({
x:Math.random()*W,y:-5,
vx:turnRate*0.5+Math.random()-0.5,
vy:1+Math.random()*2+speed*0.3,
life:60+Math.random()*40|0,ml:100,
sz:1+Math.random()*2
});
}
}

function update(dt){
if(state!=1)return;
if(dt>0.1)dt=0.1;

// === 2. PLAYER POSITIONING: Snap to ground ===
// Slope: negative=downhill (fast), positive=uphill (slow)
slopeVal=getHeight(pX,pZ+2)-getHeight(pX,pZ-2);
let slope=0.12-slopeVal*0.06;

let tt=terrainType(Math.floor(pZ));
let friction=tt==0?0.015:tt==1?0.025:tt==2?0.008:0.02;
let gravity=9.8*slope;
let turnDrag=Math.abs(turnRate)*0.08;
let dragMult=inputTuck?0.6:1;
let airDrag=speed*speed*0.001*dragMult;

speed+=gravity*dt;
speed-=(friction+turnDrag)*speed*dt;
speed-=airDrag*dt;
speed=Math.max(1,Math.min(speed,25));

// Steering
let curv=curvature(pZ)*0.002;
turnRate+=(inputX*1.5-turnRate)*dt*4;
pX+=turnRate*dt*0.8;
pX+=curv*speed*dt*0.1;

// Move forward
pZ+=speed*dt*0.5;

// Snap player Y to ground height
pY=getHeight(pX,pZ);

// Score
score+=speed*dt*2;

// === 3. CAMERA LOGIC: Spring arm with lerp ===
let t=Math.min(1,dt*5);
camX=lerp(camX,pX,t);
camY=lerp(camY,pY+3,t);
camZ=lerp(camZ,pZ-5,t);

// Snow effects
if(Math.abs(turnRate)>0.5&&speed>3){
spraySnow();
if(Math.random()<0.05)playBuf(sndCarve);
}
ambientSnow();

// Shake decay
shakeX*=0.85;shakeY*=0.85;
if(Math.abs(shakeX)<0.5)shakeX=0;
if(Math.abs(shakeY)<0.5)shakeY=0;
}

function drawHUD(){
if(state!=1)return;
let fs=Math.max(14,W*0.04|0);
g.textAlign='left';
g.font='bold '+fs+'px monospace';
g.fillStyle='#fff';
g.fillText('Score: '+Math.floor(score),10,fs+5);
g.fillText('Speed: '+speed.toFixed(1),10,fs*2+10);
if(combo>1){
g.fillStyle='#ff0';
g.fillText('Combo x'+combo+'!',10,fs*3+15);
}
// Elevation indicator (right side)
g.save();
g.translate(W-45,fs*1.5);
let sa=Math.atan2(slopeVal,4);
g.rotate(sa);
g.fillStyle=slopeVal<-0.3?'#4f8':slopeVal>0.3?'#f84':'#aaa';
g.beginPath();g.moveTo(18,0);g.lineTo(-8,-7);g.lineTo(-4,0);g.lineTo(-8,7);
g.closePath();g.fill();
g.restore();
g.textAlign='right';
g.fillStyle='#ccc';
g.font=Math.max(11,W*0.03|0)+'px monospace';
g.fillText((2000+Math.floor(pY*10))+'m',W-10,fs*3);
}

function drawTitle(){
g.textAlign='center';
g.fillStyle='#fff';
g.font='bold '+Math.max(36,W*0.1|0)+'px monospace';
g.fillText('INFINITE',W/2,H*0.28);
g.fillText('SKI',W/2,H*0.38);

g.font=Math.max(14,W*0.04|0)+'px monospace';
g.fillStyle='rgba(255,255,255,0.7)';
g.fillText('Dodge trees, hit gates, go fast!',W/2,H*0.48);

if(Date.now()%1000<600){
g.fillStyle='#fff';
g.font='bold '+Math.max(18,W*0.05|0)+'px monospace';
g.fillText('TAP TO START',W/2,H*0.62);
}

if(hiScore>0){
g.fillStyle='#ff0';
g.font=Math.max(14,W*0.04|0)+'px monospace';
g.fillText('Best: '+hiScore,W/2,H*0.72);
}

g.fillStyle='rgba(255,255,255,0.5)';
g.font=Math.max(11,W*0.03|0)+'px monospace';
g.fillText('Touch sides to steer | Bottom = tuck',W/2,H*0.82);
g.fillText('Arrow keys / mouse on desktop',W/2,H*0.87);
}

function drawGameOver(){
g.textAlign='center';
g.fillStyle='rgba(0,0,0,0.5)';
g.fillRect(0,H*0.2,W,H*0.6);
g.fillStyle='#f44';
g.font='bold '+Math.max(32,W*0.09|0)+'px monospace';
g.fillText('CRASHED!',W/2,H*0.35);
g.fillStyle='#fff';
g.font=Math.max(18,W*0.05|0)+'px monospace';
g.fillText('Score: '+Math.floor(score),W/2,H*0.47);
g.fillText('Distance: '+Math.floor(pZ)+'m',W/2,H*0.54);
if(maxCombo>1)g.fillText('Max Combo: x'+maxCombo,W/2,H*0.61);
if(Math.floor(score)>=hiScore&&hiScore>0){
g.fillStyle='#ff0';
g.fillText('NEW HIGH SCORE!',W/2,H*0.68);
}
if(Date.now()%1000<600){
g.fillStyle='#fff';
g.font='bold '+Math.max(16,W*0.045|0)+'px monospace';
g.fillText('TAP TO RETRY',W/2,H*0.78);
}
}

function resetGame(){
pX=0;pZ=0;pY=getHeight(0,0);
speed=5;turnRate=0;
camX=0;camY=pY+3;camZ=pZ-5;
score=0;combo=1;maxCombo=1;crashed=0;crashTimer=0;
particles=[];shakeX=0;shakeY=0;
}

let keys={};
let mouseDown=0,mouseX=0,mouseY=0;
onkeydown=e=>{keys[e.key]=1;if(state!=1)startOrRetry()};
onkeyup=e=>{keys[e.key]=0};

function handlePointer(e){
e.preventDefault();
let t=e.touches?e.touches[0]:e;
mouseX=t.clientX;mouseY=t.clientY;
mouseDown=1;
}
c.addEventListener('touchstart',e=>{initAudio();handlePointer(e);if(state!=1)startOrRetry()},{passive:false});
c.addEventListener('touchmove',e=>{handlePointer(e)},{passive:false});
c.addEventListener('touchend',e=>{e.preventDefault();mouseDown=0},{passive:false});
c.addEventListener('mousedown',e=>{initAudio();mouseDown=1;mouseX=e.clientX;mouseY=e.clientY;if(state!=1)startOrRetry()});
c.addEventListener('mousemove',e=>{if(mouseDown){mouseX=e.clientX;mouseY=e.clientY}});
c.addEventListener('mouseup',()=>{mouseDown=0});

function startOrRetry(){
if(state==0){state=1;resetGame()}
else if(state==2&&crashTimer<=0){state=0}
}

function processInput(){
inputX=0;inputTuck=0;
if(keys['ArrowLeft']||keys['a'])inputX=-1;
if(keys['ArrowRight']||keys['d'])inputX=1;
if(keys['ArrowDown']||keys['s'])inputTuck=1;
if(mouseDown){
let rx=(mouseX-W/2)/(W/2);
inputX=Math.max(-1,Math.min(1,rx*1.5));
if(mouseY>H*0.7)inputTuck=1;
}
}

function frame(t){
let dt=(t-lastTime)/1000;
lastTime=t;
if(dt>0.2)dt=0.016;

processInput();
if(state==1)update(dt);
if(state==2){crashTimer-=dt;shakeX*=0.9;shakeY*=0.9}

render();
drawHUD();
if(state==0)drawTitle();
if(state==2)drawGameOver();

requestAnimationFrame(frame);
}

// Initialize
pY=getHeight(0,0);
camY=pY+3;
lastTime=performance.now();
requestAnimationFrame(frame);
</script></body></html>
